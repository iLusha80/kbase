<div id="view-meeting-detail" class="view-section hidden h-[calc(100vh-6rem)] flex flex-col">

    <!-- HEADER: Back + Title + Status + Actions -->
    <div id="m-detail-header" class="flex-shrink-0 bg-white dark:bg-slate-900 relative overflow-hidden">
        <!-- Color accent bar at top -->
        <div id="m-detail-color-bar" class="absolute top-0 left-0 right-0 h-1"></div>

        <div class="px-6 py-3 border-b border-slate-200 dark:border-slate-700">
            <div class="flex items-center justify-between gap-4">
                <!-- Left: Back + Title + Status -->
                <div class="flex items-center gap-3 min-w-0 flex-1">
                    <button onclick="navigateBack('meetings', '/meetings')" class="text-slate-400 hover:text-slate-700 dark:hover:text-white flex-shrink-0 transition-colors p-1 -ml-1 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <input id="m-detail-title-input" type="text" value="Загрузка..."
                        class="text-lg font-bold text-slate-900 dark:text-white bg-transparent border-0 border-b-2 border-transparent hover:border-slate-200 focus:border-primary-500 focus:outline-none px-1 py-0.5 min-w-0 flex-1 transition-colors dark:hover:border-slate-600"
                        onblur="window.saveMeetingTitle()" onkeydown="if(event.key==='Enter'){this.blur()}">
                    <span id="m-detail-status-badge" class="flex-shrink-0 px-2.5 py-1 rounded-full text-xs font-semibold whitespace-nowrap"></span>
                </div>

                <!-- Right: Timer + Actions -->
                <div class="flex items-center gap-2 flex-shrink-0">
                    <!-- Timer (prominent for in_progress) -->
                    <div id="m-detail-timer-wrap" class="hidden">
                        <span id="m-detail-timer" class="text-lg font-mono font-bold text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-800 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-slate-700 flex items-center gap-2">
                            <span id="m-timer-dot" class="hidden relative flex h-2.5 w-2.5">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-amber-500"></span>
                            </span>
                            <span id="m-timer-text">00:00</span>
                        </span>
                    </div>

                    <!-- Start/End meeting -->
                    <button id="m-detail-start-btn" onclick="window.startMeeting()" class="hidden px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors flex items-center gap-1.5 shadow-sm hover:shadow-md">
                        <i data-lucide="play" class="w-4 h-4"></i> Начать
                    </button>
                    <button id="m-detail-end-btn" onclick="window.endMeeting()" class="hidden px-4 py-2 bg-amber-600 text-white rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors flex items-center gap-1.5 shadow-sm hover:shadow-md">
                        <i data-lucide="square" class="w-4 h-4"></i> Завершить
                    </button>

                    <div class="w-px h-6 bg-slate-200 dark:bg-slate-700"></div>

                    <button id="m-detail-edit-btn" class="p-1.5 text-slate-400 hover:text-slate-700 dark:hover:text-white rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" title="Редактировать">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                    </button>
                    <button id="m-detail-delete-btn" class="p-1.5 text-slate-400 hover:text-red-500 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" title="Удалить">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Sub-header: date, type, project, participants count -->
            <div class="flex items-center gap-4 mt-2 ml-8 text-xs text-slate-500 dark:text-slate-400">
                <span id="m-detail-date" class="flex items-center gap-1.5">
                    <i data-lucide="calendar" class="w-3.5 h-3.5"></i> -
                </span>
                <span id="m-detail-type-label" class="flex items-center gap-1.5">
                    <span id="m-detail-type-dot" class="w-2 h-2 rounded-full bg-slate-300"></span>
                    <span>-</span>
                </span>
                <span id="m-detail-project-label" class="flex items-center gap-1.5 cursor-pointer hover:text-primary-600 transition-colors">
                    <i data-lucide="briefcase" class="w-3.5 h-3.5"></i> <span>-</span>
                </span>
                <span id="m-detail-participants-count" class="flex items-center gap-1.5">
                    <i data-lucide="users" class="w-3.5 h-3.5"></i> <span>0</span>
                </span>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT: Notes + Sidebar -->
    <div class="flex-1 flex overflow-hidden">

        <!-- LEFT: Notes area (chat-like) -->
        <div class="flex-1 flex flex-col min-w-0">

            <!-- Floating timer bar (shown during active meeting) -->
            <div id="m-active-timer-bar" class="hidden flex-shrink-0 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-b border-amber-200/50 dark:border-amber-800/30 px-4 py-2">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="relative flex h-3 w-3">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                        </div>
                        <span class="text-xs font-semibold text-amber-800 dark:text-amber-300 uppercase tracking-wider">Идёт встреча</span>
                        <span id="m-float-timer" class="text-lg font-mono font-bold text-amber-900 dark:text-amber-200 tabular-nums">00:00</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="window.toggleSpeechRecognition()" id="m-float-mic-btn" class="px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-all flex items-center gap-1.5">
                            <i data-lucide="mic" class="w-3.5 h-3.5"></i> Диктовка
                        </button>
                        <button onclick="window.endMeeting()" class="px-3 py-1.5 text-xs font-medium text-white bg-amber-600 hover:bg-amber-700 rounded-lg transition-colors flex items-center gap-1.5 shadow-sm">
                            <i data-lucide="square" class="w-3.5 h-3.5"></i> Завершить
                        </button>
                    </div>
                </div>
            </div>

            <!-- Completed meeting bar (shown after meeting ends) -->
            <div id="m-completed-bar" class="hidden flex-shrink-0 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-b border-green-200/50 dark:border-green-800/30 px-4 py-2">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i data-lucide="check-circle-2" class="w-4 h-4 text-green-600 dark:text-green-400"></i>
                        <span class="text-xs font-semibold text-green-800 dark:text-green-300">Встреча завершена</span>
                        <span id="m-completed-duration" class="text-sm font-medium text-green-700 dark:text-green-300"></span>
                    </div>
                    <button onclick="window.toggleMeetingSummary()" class="px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-300 bg-white dark:bg-slate-800 rounded-lg border border-green-200 dark:border-green-800 hover:bg-green-50 dark:hover:bg-green-900/30 transition-all flex items-center gap-1.5">
                        <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Написать итог
                    </button>
                </div>
            </div>

            <!-- Category filter chips -->
            <div id="m-category-filter" class="hidden flex-shrink-0 border-b border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900 px-4 py-1.5">
                <div class="flex items-center gap-1.5">
                    <span class="text-[10px] text-slate-400 dark:text-slate-600 mr-1">Фильтр:</span>
                    <button onclick="window.filterNotesByCategory('all')" class="note-cat-filter active px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="all">Все</button>
                    <button onclick="window.filterNotesByCategory('note')" class="note-cat-filter px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="note">Заметки</button>
                    <button onclick="window.filterNotesByCategory('decision')" class="note-cat-filter px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="decision">Решения</button>
                    <button onclick="window.filterNotesByCategory('question')" class="note-cat-filter px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="question">Вопросы</button>
                    <button onclick="window.filterNotesByCategory('task')" class="note-cat-filter px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="task">Задачи</button>
                </div>
            </div>

            <!-- Notes list (scrollable) -->
            <div id="m-detail-notes-list" class="flex-1 overflow-y-auto px-4 py-3 custom-scrollbar relative">
                <!-- Notes rendered by JS -->
                <div id="m-notes-empty" class="flex flex-col items-center justify-center h-full text-slate-400 dark:text-slate-600">
                    <div class="w-16 h-16 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center mb-3">
                        <i data-lucide="message-square-plus" class="w-8 h-8 opacity-30"></i>
                    </div>
                    <p class="text-sm font-medium mb-1">Начните вводить заметки</p>
                    <p class="text-xs opacity-60 mb-3">Enter для добавления, микрофон для голосового ввода</p>
                    <div class="flex items-center gap-3 text-[11px] opacity-50">
                        <span class="flex items-center gap-1"><kbd class="px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 rounded text-[10px] font-mono">Enter</kbd> отправить</span>
                        <span class="flex items-center gap-1"><i data-lucide="mic" class="w-3 h-3"></i> голос</span>
                    </div>
                </div>
            </div>

            <!-- Note input (bottom, sticky chat-style) -->
            <div class="flex-shrink-0 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2.5 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.03)]">
                <!-- Category chips + hints row -->
                <div class="flex items-center justify-between mb-1.5">
                    <div class="flex items-center gap-1">
                        <span id="m-notes-count" class="text-[10px] text-slate-400 dark:text-slate-500 font-medium mr-2"></span>
                        <button onclick="window.setNoteCategory('note')" class="note-cat-chip active px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="note" title="Обычная заметка">Заметка</button>
                        <button onclick="window.setNoteCategory('decision')" class="note-cat-chip px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="decision" title="Решение">Решение</button>
                        <button onclick="window.setNoteCategory('question')" class="note-cat-chip px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="question" title="Открытый вопрос">Вопрос</button>
                        <button onclick="window.setNoteCategory('task')" class="note-cat-chip px-2 py-0.5 rounded-full text-[10px] font-medium transition-all" data-cat="task" title="Задача">Задача</button>
                    </div>
                    <div class="flex items-center gap-2 text-[10px] text-slate-400 dark:text-slate-600">
                        <span class="flex items-center gap-1"><kbd class="px-1 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-[9px] font-mono">Enter</kbd></span>
                        <span class="flex items-center gap-1"><kbd class="px-1 py-0.5 bg-slate-100 dark:bg-slate-800 rounded text-[9px] font-mono">Ctrl+M</kbd> микрофон</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <!-- Mic button -->
                    <button id="m-mic-btn" onclick="window.toggleSpeechRecognition()" class="p-2 text-slate-400 hover:text-red-500 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all flex-shrink-0" title="Голосовой ввод (Ctrl+M)">
                        <i data-lucide="mic" class="w-5 h-5"></i>
                    </button>
                    <input type="text" id="m-note-input" placeholder="Напишите заметку..."
                        class="flex-1 px-4 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/10 bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-500 transition-all"
                        onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();window.addMeetingNote()}">
                    <button onclick="window.addMeetingNote()" class="p-2.5 bg-primary-600 text-white rounded-xl text-sm font-medium hover:bg-primary-700 transition-colors flex-shrink-0 shadow-sm hover:shadow-md">
                        <i data-lucide="send-horizontal" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Summary section (collapsible) -->
            <div id="m-detail-summary-section" class="flex-shrink-0 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
                <button onclick="window.toggleMeetingSummary()" class="w-full flex items-center justify-between px-6 py-2 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                    <span class="flex items-center gap-2">
                        <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Итог встречи
                    </span>
                    <i data-lucide="chevron-up" id="m-summary-chevron" class="w-4 h-4 transition-transform"></i>
                </button>
                <div id="m-summary-body" class="hidden px-6 pb-3">
                    <textarea id="m-detail-summary" rows="3" placeholder="Краткий итог встречи..."
                        class="w-full p-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-primary-500 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-500 resize-none"></textarea>
                    <div class="flex justify-end mt-2 gap-2">
                        <button id="m-ai-analyze-btn" onclick="window.analyzeMeetingAI()" class="px-3 py-1.5 text-xs font-medium text-purple-600 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-800 dark:hover:bg-purple-900/40 flex items-center gap-1.5">
                                <i data-lucide="sparkles" class="w-3.5 h-3.5"></i> Разобрать через AI
                        </button>
                        <button onclick="window.saveMeetingSummary()" class="px-3 py-1.5 bg-slate-800 text-white text-xs font-medium rounded-lg hover:bg-slate-700 dark:bg-primary-600 dark:hover:bg-primary-500 transition-colors">
                            Сохранить итог
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile sidebar toggle button -->
        <button id="m-sidebar-toggle" onclick="window.toggleMeetingSidebar()" class="lg:hidden fixed bottom-20 right-4 z-40 w-10 h-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-full shadow-lg flex items-center justify-center text-slate-500 hover:text-primary-600 transition-all">
            <i data-lucide="panel-right" class="w-5 h-5"></i>
        </button>

        <!-- RIGHT SIDEBAR with tabs -->
        <aside id="m-detail-sidebar" class="w-80 flex-shrink-0 border-l border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 hidden lg:flex flex-col
            max-lg:fixed max-lg:inset-y-0 max-lg:right-0 max-lg:z-50 max-lg:w-80 max-lg:shadow-xl max-lg:bg-white max-lg:dark:bg-slate-900">

            <!-- Mobile close button -->
            <div class="lg:hidden flex items-center justify-between px-4 py-2 border-b border-slate-200 dark:border-slate-700">
                <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Детали</span>
                <button onclick="window.toggleMeetingSidebar()" class="p-1 text-slate-400 hover:text-slate-700 dark:hover:text-white rounded-lg">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Sidebar tabs -->
            <div class="flex-shrink-0 border-b border-slate-200 dark:border-slate-700 px-2 pt-2">
                <div class="flex gap-0.5">
                    <button onclick="window.switchSidebarTab('info')" class="sidebar-tab active flex-1 px-2 py-1.5 text-[11px] font-medium rounded-t-lg transition-all flex items-center justify-center gap-1" data-tab="info">
                        <i data-lucide="info" class="w-3 h-3"></i> Инфо
                    </button>
                    <button onclick="window.switchSidebarTab('people')" class="sidebar-tab flex-1 px-2 py-1.5 text-[11px] font-medium rounded-t-lg transition-all flex items-center justify-center gap-1" data-tab="people">
                        <i data-lucide="users" class="w-3 h-3"></i> Участники
                    </button>
                    <button onclick="window.switchSidebarTab('tasks')" class="sidebar-tab flex-1 px-2 py-1.5 text-[11px] font-medium rounded-t-lg transition-all flex items-center justify-center gap-1" data-tab="tasks">
                        <i data-lucide="check-square" class="w-3 h-3"></i> Задачи
                    </button>
                    <button onclick="window.switchSidebarTab('history')" class="sidebar-tab flex-1 px-2 py-1.5 text-[11px] font-medium rounded-t-lg transition-all flex items-center justify-center gap-1" data-tab="history">
                        <i data-lucide="clock" class="w-3 h-3"></i> Лог
                    </button>
                </div>
            </div>

            <!-- Tab panels -->
            <div class="flex-1 overflow-y-auto custom-scrollbar p-4">

                <!-- Info panel -->
                <div id="m-tab-info" class="sidebar-panel space-y-3">
                    <div class="space-y-2.5 text-sm">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-500 dark:text-slate-400 text-xs">Дата</span>
                            <span id="m-side-date" class="font-medium text-slate-800 dark:text-slate-200 text-xs">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-500 dark:text-slate-400 text-xs">Время</span>
                            <span id="m-side-time" class="font-medium text-slate-800 dark:text-slate-200 text-xs">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-500 dark:text-slate-400 text-xs">Длительность</span>
                            <span id="m-side-duration" class="font-medium text-slate-800 dark:text-slate-200 text-xs">-</span>
                        </div>
                    </div>

                    <!-- Agenda (checklist style) -->
                    <div id="m-side-agenda-block" class="hidden mt-3 pt-3 border-t border-slate-100 dark:border-slate-700/50">
                        <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                            <i data-lucide="list-ordered" class="w-3 h-3"></i> Повестка
                        </h4>
                        <div id="m-side-agenda" class="text-xs text-slate-600 dark:text-slate-400 leading-relaxed space-y-1"></div>
                    </div>
                </div>

                <!-- People panel -->
                <div id="m-tab-people" class="sidebar-panel hidden">
                    <div id="m-side-participants" class="space-y-2">
                        <span class="text-xs text-slate-400 italic">Нет участников</span>
                    </div>
                </div>

                <!-- Tasks panel -->
                <div id="m-tab-tasks" class="sidebar-panel hidden">
                    <div id="m-side-tasks" class="space-y-1.5">
                        <span class="text-xs text-slate-400 italic">Нет задач</span>
                    </div>
                </div>

                <!-- History panel -->
                <div id="m-tab-history" class="sidebar-panel hidden">
                    <div id="m-side-history" class="space-y-1 text-[11px] text-slate-500 dark:text-slate-500">
                        <span class="text-slate-400 italic">Нет истории</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile sidebar backdrop -->
        <div id="m-sidebar-backdrop" class="hidden fixed inset-0 z-40 bg-slate-900/30 backdrop-blur-sm lg:hidden" onclick="window.toggleMeetingSidebar()"></div>
    </div>

    <!-- AI Analysis Modal -->
    <div id="m-ai-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="window.closeAIModal()"></div>
        <div class="flex min-h-screen items-center justify-center p-4">
            <div class="relative bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 fade-in dark:bg-slate-800 dark:border dark:border-slate-700 max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold flex items-center text-slate-900 dark:text-white">
                        <i data-lucide="sparkles" class="w-5 h-5 mr-2 text-purple-500"></i> AI-анализ встречи
                    </h3>
                    <button onclick="window.closeAIModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-white">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="m-ai-content" class="space-y-4">
                    <div class="flex items-center justify-center py-8 text-slate-400">
                        <i data-lucide="loader-2" class="w-6 h-6 animate-spin mr-2"></i> Анализирую...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
