<div id="view-meeting-detail" class="view-section hidden h-[calc(100vh-6rem)] flex flex-col">

    <!-- HEADER: Back + Title + Status + Actions -->
    <div class="flex-shrink-0 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-6 py-3">
        <div class="flex items-center justify-between gap-4">
            <!-- Left: Back + Title -->
            <div class="flex items-center gap-3 min-w-0 flex-1">
                <button onclick="navigateBack('meetings', '/meetings')" class="text-slate-400 hover:text-slate-700 dark:hover:text-white flex-shrink-0 transition-colors">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <input id="m-detail-title-input" type="text" value="Загрузка..."
                    class="text-lg font-bold text-slate-900 dark:text-white bg-transparent border-0 border-b-2 border-transparent hover:border-slate-200 focus:border-primary-500 focus:outline-none px-1 py-0.5 min-w-0 flex-1 transition-colors dark:hover:border-slate-600"
                    onblur="window.saveMeetingTitle()" onkeydown="if(event.key==='Enter'){this.blur()}">
                <span id="m-detail-status-badge" class="flex-shrink-0 px-2.5 py-1 rounded-full text-xs font-semibold border whitespace-nowrap"></span>
            </div>

            <!-- Right: Actions -->
            <div class="flex items-center gap-2 flex-shrink-0">
                <!-- Start/End meeting -->
                <button id="m-detail-start-btn" onclick="window.startMeeting()" class="hidden px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors flex items-center gap-1.5">
                    <i data-lucide="play" class="w-4 h-4"></i> Начать
                </button>
                <button id="m-detail-end-btn" onclick="window.endMeeting()" class="hidden px-3 py-1.5 bg-amber-600 text-white rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors flex items-center gap-1.5">
                    <i data-lucide="square" class="w-4 h-4"></i> Завершить
                </button>

                <!-- Timer -->
                <span id="m-detail-timer" class="hidden text-xs font-mono text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded"></span>

                <div class="w-px h-6 bg-slate-200 dark:bg-slate-700"></div>

                <button id="m-detail-edit-btn" class="p-1.5 text-slate-400 hover:text-slate-700 dark:hover:text-white rounded transition-colors" title="Редактировать">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                </button>
                <button id="m-detail-delete-btn" class="p-1.5 text-slate-400 hover:text-red-500 rounded transition-colors" title="Удалить">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        </div>

        <!-- Sub-header: date, type, project, participants count -->
        <div class="flex items-center gap-4 mt-1.5 ml-8 text-xs text-slate-500 dark:text-slate-400">
            <span id="m-detail-date" class="flex items-center gap-1">
                <i data-lucide="calendar" class="w-3 h-3"></i> -
            </span>
            <span id="m-detail-type-label" class="flex items-center gap-1">
                <i data-lucide="tag" class="w-3 h-3"></i> -
            </span>
            <span id="m-detail-project-label" class="flex items-center gap-1 cursor-pointer hover:text-primary-600 transition-colors">
                <i data-lucide="briefcase" class="w-3 h-3"></i> <span>-</span>
            </span>
            <span id="m-detail-participants-count" class="flex items-center gap-1">
                <i data-lucide="users" class="w-3 h-3"></i> <span>0</span>
            </span>
        </div>
    </div>

    <!-- MAIN CONTENT: Notes + Sidebar -->
    <div class="flex-1 flex overflow-hidden">

        <!-- LEFT: Notes area (chat-like) -->
        <div class="flex-1 flex flex-col min-w-0">

            <!-- Notes list (scrollable) -->
            <div id="m-detail-notes-list" class="flex-1 overflow-y-auto px-6 py-4 space-y-1 custom-scrollbar">
                <!-- Notes rendered by JS -->
                <div id="m-notes-empty" class="flex flex-col items-center justify-center h-full text-slate-400 dark:text-slate-600">
                    <i data-lucide="message-square-plus" class="w-12 h-12 mb-3 opacity-30"></i>
                    <p class="text-sm">Начните вводить заметки...</p>
                    <p class="text-xs mt-1 opacity-60">Enter для добавления</p>
                </div>
            </div>

            <!-- Note input (bottom, like chat) -->
            <div class="flex-shrink-0 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-6 py-3">
                <div class="flex items-center gap-2">
                    <!-- Mic button (placeholder for Speech API) -->
                    <button id="m-mic-btn" onclick="window.toggleSpeechRecognition()" class="p-2.5 text-slate-400 hover:text-primary-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors flex-shrink-0" title="Голосовой ввод (Speech-to-Text)">
                        <i data-lucide="mic" class="w-5 h-5"></i>
                    </button>
                    <input type="text" id="m-note-input" placeholder="Заметка... (Enter для добавления)"
                        class="flex-1 px-4 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500/20 bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-500 transition-all"
                        onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();window.addMeetingNote()}">
                    <button onclick="window.addMeetingNote()" class="px-4 py-2.5 bg-primary-600 text-white rounded-xl text-sm font-medium hover:bg-primary-700 transition-colors flex-shrink-0 flex items-center gap-1.5">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Summary section (collapsible) -->
            <div id="m-detail-summary-section" class="flex-shrink-0 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
                <button onclick="window.toggleMeetingSummary()" class="w-full flex items-center justify-between px-6 py-2 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                    <span class="flex items-center gap-2">
                        <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Итог встречи
                    </span>
                    <i data-lucide="chevron-up" id="m-summary-chevron" class="w-4 h-4 transition-transform"></i>
                </button>
                <div id="m-summary-body" class="hidden px-6 pb-3">
                    <textarea id="m-detail-summary" rows="3" placeholder="Краткий итог встречи..."
                        class="w-full p-3 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-primary-500 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-500 resize-none"></textarea>
                    <div class="flex justify-end mt-2 gap-2">
                        <button id="m-ai-analyze-btn" onclick="window.analyzeMeetingAI()" class="px-3 py-1.5 text-xs font-medium text-purple-600 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-800 dark:hover:bg-purple-900/40 flex items-center gap-1.5">
                            <i data-lucide="sparkles" class="w-3.5 h-3.5"></i> Разобрать через AI
                        </button>
                        <button onclick="window.saveMeetingSummary()" class="px-3 py-1.5 bg-slate-800 text-white text-xs font-medium rounded-lg hover:bg-slate-700 dark:bg-primary-600 dark:hover:bg-primary-500 transition-colors">
                            Сохранить итог
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDEBAR -->
        <aside id="m-detail-sidebar" class="w-72 flex-shrink-0 border-l border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 overflow-y-auto custom-scrollbar hidden lg:block">
            <div class="p-4 space-y-5">

                <!-- Info -->
                <div>
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Информация</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-slate-500 dark:text-slate-400">Дата</span>
                            <span id="m-side-date" class="font-medium text-slate-800 dark:text-slate-200">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-500 dark:text-slate-400">Время</span>
                            <span id="m-side-time" class="font-medium text-slate-800 dark:text-slate-200">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-500 dark:text-slate-400">Длительность</span>
                            <span id="m-side-duration" class="font-medium text-slate-800 dark:text-slate-200">-</span>
                        </div>
                    </div>
                </div>

                <div class="h-px bg-slate-100 dark:bg-slate-800"></div>

                <!-- Participants -->
                <div>
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Участники</h4>
                    <div id="m-side-participants" class="space-y-1.5">
                        <span class="text-xs text-slate-400 italic">Нет участников</span>
                    </div>
                </div>

                <div class="h-px bg-slate-100 dark:bg-slate-800"></div>

                <!-- Related Tasks -->
                <div>
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Связанные задачи</h4>
                    <div id="m-side-tasks" class="space-y-1.5">
                        <span class="text-xs text-slate-400 italic">Нет задач</span>
                    </div>
                </div>

                <div class="h-px bg-slate-100 dark:bg-slate-800"></div>

                <!-- Agenda (if any) -->
                <div id="m-side-agenda-block" class="hidden">
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Повестка</h4>
                    <div id="m-side-agenda" class="text-xs text-slate-600 dark:text-slate-400 whitespace-pre-wrap bg-slate-50 dark:bg-slate-800 p-2.5 rounded-lg"></div>
                </div>

                <!-- History -->
                <div>
                    <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">История</h4>
                    <div id="m-side-history" class="space-y-1 text-[11px] text-slate-500 dark:text-slate-500 max-h-40 overflow-y-auto">
                        <span class="text-slate-400 italic">Нет истории</span>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- AI Analysis Modal -->
    <div id="m-ai-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="window.closeAIModal()"></div>
        <div class="flex min-h-screen items-center justify-center p-4">
            <div class="relative bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 fade-in dark:bg-slate-800 dark:border dark:border-slate-700 max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold flex items-center text-slate-900 dark:text-white">
                        <i data-lucide="sparkles" class="w-5 h-5 mr-2 text-purple-500"></i> AI-анализ встречи
                    </h3>
                    <button onclick="window.closeAIModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-white">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="m-ai-content" class="space-y-4">
                    <div class="flex items-center justify-center py-8 text-slate-400">
                        <i data-lucide="loader-2" class="w-6 h-6 animate-spin mr-2"></i> Анализирую...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
